## Client.js Documentation

### Table of Contents

| Section | Description |
|---|---|
| **Overview** |  General information about the Client module |
| **Class: Client** |  Details of the Client class |
| **Methods** |  Explanation of each method in the Client class |
| **Dependencies** |  Modules required for this module |

### Overview

The `Client.js` module defines a client-side component for communication between applications. This module utilizes a `net` or `tls` socket to establish a connection and handle data exchange. It provides methods for sending and receiving events, managing connection retries, and handling potential errors.

### Class: Client

The `Client` class represents a client instance. It extends the `Events` class, providing event-based communication capabilities.

**Properties:**

| Property | Description | Type |
|---|---|---|
| `Client` | Reference to the `Client` class itself | `Client` |
| `config` | Configuration object for the client | `Object` |
| `queue` | A queue for handling synchronous event emissions | `Queue` |
| `socket` |  The underlying socket connection | `net.Socket` or `tls.Socket` |
| `connect` | Function to establish a connection | `Function` |
| `emit` | Function to send an event to the server | `Function` |
| `log` | Function for logging messages | `Function` |
| `retriesRemaining` | Number of remaining connection retries | `Number` |
| `explicitlyDisconnected` | Boolean flag indicating if the client disconnected explicitly | `Boolean` |

**Constructor:**

```javascript
constructor(config, log) {
    super();
    Object.assign(
        this,
        {
            Client: Client,
            config: config,
            queue: new Queue,
            socket: false,
            connect: connect,
            emit: emit,
            log: log,
            retriesRemaining: config.maxRetries || 0,
            explicitlyDisconnected: false
        }
    );

    eventParser = new EventParser(this.config);
}
```

The constructor initializes the Client object with the provided configuration, creates a new `Queue` instance, and sets up default properties. It also initializes an `EventParser` instance using the client's configuration.

### Methods

#### emit(type, data)

Sends an event to the server.

**Parameters:**

| Parameter | Description | Type |
|---|---|---|
| `type` | Type of the event | `String` |
| `data` | Data associated with the event | `Object` |

**Explanation:**

The `emit` method first logs the event details. Then, it creates a `Message` instance, sets its type and data, and formats it using the `eventParser`. If the configuration specifies `rawBuffer`, the message is converted directly to a buffer. Finally, it writes the message to the socket if it's asynchronous or adds it to the queue for synchronous emission.

#### syncEmit(message)

Synchronous emission of an event.

**Parameters:**

| Parameter | Description | Type |
|---|---|---|
| `message` | The message to be emitted | `Message` |

**Explanation:**

The `syncEmit` method logs the message details and writes it to the socket. This method is called from the `queue` when handling synchronous events.

#### connect()

Establishes a connection to the server.

**Explanation:**

The `connect` method first logs the connection attempt. It then determines the connection type (Unix socket or TCP) based on the provided path and port. If the connection is to a Unix socket, it handles platform-specific path adjustments. For TCP connections, it allows for configuration of local address, port, family, hints, and lookup. It then creates either a `net.Socket` or `tls.Socket` based on the configuration and the connection type.

The method sets up event listeners for:

* **`error`**: Handles socket errors by logging the error and publishing an `error` event.
* **`connect`**: Handles successful connection by publishing a `connect` event and resetting the retry count.
* **`close`**: Handles socket closure by logging the event, checking if retries are exhausted or the `stopRetrying` flag is set, and publishing `disconnect` and `destroy` events. If retries are allowed, it schedules a retry attempt after a specified timeout.
* **`data`**: Handles incoming data. If `rawBuffer` is enabled, it publishes the data as a buffer. Otherwise, it parses the data using the `eventParser`, publishes individual events, and handles synchronous event queueing.

### Dependencies

| Module | Description |
|---|---|
| `net` |  Provides network socket functions |
| `tls` | Provides TLS socket functions |
| `EventParser` |  Parses event data |
| `js-message` |  Provides a message class for formatting data |
| `fs` |  Provides file system operations |
| `@node-ipc/js-queue` |  Provides a queue implementation |
| `event-pubsub` |  Provides event-based communication functionality |

**Emoji Legend:**

* 💻: Code
* 🤝: Collaboration
* 🔌: Connection
* 📡: Communication
* ⏳: Time
* 📦: Package
* 🚦: Control
* 🐛: Bug
* 📝: Documentation
* 💡: Idea
* 🎉: Success
* 😭: Failure
